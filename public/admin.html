<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç®¡ç†åå° - å“åº”å¼ç‰ˆ</title>
    
    <!-- Firebase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js"></script>
    <script src="config.js"></script>
    <script src="supabase-adapter.js"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            overflow-x: hidden;
        }
        
        /* å“åº”å¼å®¹å™¨ */
        .login-container {
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
        }
        
        @media (min-width: 768px) {
            .login-container {
                padding: 40px;
            }
        }
        
        .login-header { text-align: center; margin-bottom: 25px; }
        
        @media (min-width: 768px) {
            .login-header { margin-bottom: 30px; }
        }
        
        .login-icon { 
            font-size: 50px; 
            margin-bottom: 15px; 
        }
        
        @media (min-width: 768px) {
            .login-icon { 
                font-size: 60px; 
                margin-bottom: 20px; 
            }
        }
        
        .login-title {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        
        @media (min-width: 768px) {
            .login-title {
                font-size: 28px;
                margin-bottom: 10px;
            }
        }
        
        .login-subtitle { 
            color: #6c757d; 
            font-size: 13px; 
        }
        
        @media (min-width: 768px) {
            .login-subtitle { font-size: 14px; }
        }
        
        .form-group { margin-bottom: 15px; }
        
        @media (min-width: 768px) {
            .form-group { margin-bottom: 20px; }
        }
        
        .form-label { 
            display: block; 
            margin-bottom: 6px; 
            font-weight: 600; 
            color: #333;
            font-size: 13px;
        }
        
        @media (min-width: 768px) {
            .form-label {
                margin-bottom: 8px;
                font-size: 14px;
            }
        }
        
        .form-input {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            -webkit-appearance: none;
        }
        
        @media (min-width: 768px) {
            .form-input {
                padding: 12px 16px;
                border-radius: 10px;
                font-size: 15px;
            }
        }
        
        .form-input:focus { border-color: #667eea; }
        
        /* å“åº”å¼åå°å®¹å™¨ */
        .admin-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 10px;
        }
        
        @media (min-width: 768px) {
            .admin-container {
                padding: 20px;
            }
        }
        
        .admin-wrapper {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* å“åº”å¼Header */
        .admin-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        @media (min-width: 768px) {
            .admin-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                padding: 20px 30px;
                margin-bottom: 20px;
                border-radius: 20px;
            }
        }
        
        .admin-title-section {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .admin-title {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        @media (min-width: 768px) {
            .admin-title { font-size: 28px; }
        }
        
        .admin-subtitle {
            font-size: 12px;
            color: #6c757d;
        }
        
        @media (min-width: 768px) {
            .admin-subtitle { font-size: 14px; }
        }
        
        .admin-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        @media (min-width: 768px) {
            .admin-actions { gap: 10px; }
        }
        
        /* æŒ‰é’®å“åº”å¼ */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            -webkit-tap-highlight-color: transparent;
        }
        
        @media (min-width: 768px) {
            .btn {
                padding: 10px 20px;
                border-radius: 10px;
                font-size: 14px;
            }
        }
        
        .btn:active { transform: scale(0.95); }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        .btn-secondary { background: #f8f9fa; color: #333; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #856404; }
        
        .btn-small {
            padding: 4px 8px;
            font-size: 11px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            white-space: nowrap;
        }
        
        @media (min-width: 768px) {
            .btn-small {
                padding: 5px 10px;
                font-size: 12px;
                border-radius: 6px;
            }
        }
        
        /* å†…å®¹åŒºåŸŸå“åº”å¼ */
        .admin-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        @media (min-width: 768px) {
            .admin-content {
                border-radius: 20px;
                padding: 30px;
            }
        }
        
        /* ç»Ÿè®¡å¡ç‰‡å“åº”å¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        @media (min-width: 480px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
                margin-bottom: 30px;
            }
        }
        
        .stat-card {
            padding: 20px 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            color: white;
            text-align: center;
        }
        
        @media (min-width: 768px) {
            .stat-card {
                padding: 25px;
                border-radius: 15px;
                text-align: left;
            }
        }
        
        .stat-card h3 { 
            font-size: 12px; 
            opacity: 0.9; 
            margin-bottom: 8px; 
        }
        
        @media (min-width: 768px) {
            .stat-card h3 { 
                font-size: 14px; 
                margin-bottom: 10px; 
            }
        }
        
        .stat-value { 
            font-size: 28px; 
            font-weight: 700; 
        }
        
        @media (min-width: 768px) {
            .stat-value { font-size: 36px; }
        }
        
        /* æ ‡ç­¾é¡µå“åº”å¼ */
        .admin-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        @media (min-width: 768px) {
            .admin-tabs {
                gap: 10px;
                margin-bottom: 30px;
                padding-bottom: 20px;
                overflow-x: visible;
            }
        }
        
        .admin-tab {
            padding: 10px 16px;
            border: none;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        @media (min-width: 768px) {
            .admin-tab {
                padding: 12px 24px;
                border-radius: 10px;
                font-size: 15px;
            }
        }
        
        .admin-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        /* å·¥å…·æ å“åº”å¼ */
        .toolbar {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        @media (min-width: 768px) {
            .toolbar {
                gap: 10px;
                margin-bottom: 20px;
            }
        }
        
        /* è¡¨æ ¼å“åº”å¼ */
        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 12px;
            background: white;
        }
        
        @media (min-width: 768px) {
            .table-wrapper {
                border-radius: 15px;
            }
        }
        
        .data-table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
            background: white;
        }
        
        .data-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            white-space: nowrap;
        }
        
        @media (min-width: 768px) {
            .data-table th {
                padding: 15px;
                font-size: 14px;
            }
        }
        
        .data-table td { 
            padding: 12px 10px; 
            border-bottom: 1px solid #f0f0f0;
            font-size: 12px;
        }
        
        @media (min-width: 768px) {
            .data-table td {
                padding: 15px;
                font-size: 14px;
            }
        }
        
        .data-table tr:hover { background: #f8f9fa; }
        
        /* å¾½ç« å“åº”å¼ */
        .badge {
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        @media (min-width: 768px) {
            .badge {
                padding: 5px 10px;
                border-radius: 20px;
                font-size: 12px;
            }
        }
        
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-success { background: #d4edda; color: #155724; }
        .badge-online { background: #d4edda; color: #155724; }
        .badge-offline { background: #f8d7da; color: #721c24; }
        
        /* èŠå¤©é¢„è§ˆå“åº”å¼ */
        .chat-preview {
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }
        
        @media (min-width: 768px) {
            .chat-preview {
                padding: 15px;
                margin-bottom: 10px;
            }
        }
        
        .chat-preview:active { background: #f0f0f0; }
        
        @media (min-width: 768px) {
            .chat-preview:hover { background: #f8f9fa; }
        }
        
        .chat-preview-header {
            font-weight: 600;
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px solid #e9ecef;
            font-size: 13px;
        }
        
        @media (min-width: 768px) {
            .chat-preview-header {
                margin-bottom: 8px;
                padding-bottom: 8px;
                font-size: 14px;
            }
        }
        
        /* ç©ºçŠ¶æ€å“åº”å¼ */
        .empty-state {
            text-align: center;
            padding: 30px 20px;
            color: #6c757d;
            font-size: 14px;
        }
        
        @media (min-width: 768px) {
            .empty-state {
                padding: 40px;
                font-size: 15px;
            }
        }
        
        /* æ¨¡æ€æ¡†å“åº”å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        @media (min-width: 768px) {
            .modal {
                border-radius: 20px;
                padding: 30px;
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        @media (min-width: 768px) {
            .modal-header {
                margin-bottom: 20px;
                padding-bottom: 15px;
            }
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        @media (min-width: 768px) {
            .modal-title {
                font-size: 24px;
            }
        }
        
        .close-btn {
            width: 30px;
            height: 30px;
            border: none;
            background: #f8f9fa;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        @media (min-width: 768px) {
            .close-btn {
                width: 32px;
                height: 32px;
                font-size: 18px;
            }
        }
        
        .info-section { margin-bottom: 20px; }
        
        @media (min-width: 768px) {
            .info-section { margin-bottom: 25px; }
        }
        
        .info-section h3 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        @media (min-width: 768px) {
            .info-section h3 {
                font-size: 16px;
                margin-bottom: 12px;
            }
        }
        
        .info-card {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        @media (min-width: 768px) {
            .info-card {
                padding: 15px;
                border-radius: 10px;
            }
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #e9ecef;
            font-size: 13px;
            gap: 10px;
        }
        
        @media (min-width: 768px) {
            .info-row {
                padding: 8px 0;
                font-size: 14px;
            }
        }
        
        .info-row:last-child { border-bottom: none; }
        
        .info-row span:first-child {
            flex-shrink: 0;
        }
        
        .info-row span:last-child {
            text-align: right;
            word-break: break-word;
        }
        
        .history-item {
            padding: 8px;
            background: white;
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 12px;
        }
        
        @media (min-width: 768px) {
            .history-item {
                padding: 10px;
                border-radius: 8px;
                margin-bottom: 8px;
                font-size: 14px;
            }
        }
        
        .chat-messages-list {
            max-height: 300px;
            overflow-y: auto;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            -webkit-overflow-scrolling: touch;
        }
        
        @media (min-width: 768px) {
            .chat-messages-list {
                max-height: 400px;
                padding: 15px;
                border-radius: 10px;
            }
        }
        
        .chat-message-item {
            padding: 8px;
            background: white;
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        @media (min-width: 768px) {
            .chat-message-item {
                padding: 10px;
                border-radius: 8px;
                margin-bottom: 10px;
                font-size: 14px;
            }
        }
        
        /* è§¦æ‘¸ä¼˜åŒ– */
        @media (hover: none) {
            .btn, .admin-tab, .chat-preview, .close-btn {
                -webkit-tap-highlight-color: transparent;
            }
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        // ==================== Supabaseé…ç½® ====================
        const supabase = initSupabase(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
        const db = new SupabaseAdapter(supabase);
        
        const { useState, useEffect } = React;
        
        // ç®¡ç†å‘˜è®¤è¯
        const AdminAuth = {
          get: () => localStorage.getItem('admin_authenticated') === 'true',
          set: (value) => localStorage.setItem('admin_authenticated', value),
          clear: () => localStorage.removeItem('admin_authenticated')
        };
        
        // ä¸»åº”ç”¨
        const AdminPanel = () => {
          const [isAuthenticated, setIsAuthenticated] = useState(false);
          const [username, setUsername] = useState('');
          const [password, setPassword] = useState('');
          const [activeTab, setActiveTab] = useState('users');
          const [users, setUsers] = useState([]);
          const [selectedUser, setSelectedUser] = useState(null);
          const [editingUser, setEditingUser] = useState(null);
          const [chats, setChats] = useState({});
          const [onlineUsers, setOnlineUsers] = useState([]);
          const [selectedChat, setSelectedChat] = useState(null);
          const [selectedUserIds, setSelectedUserIds] = useState([]);
          
          const ADMIN_USERNAME = 'admin';
          const ADMIN_PASSWORD = 'admin123';
          
          useEffect(() => {
            const authStatus = AdminAuth.get();
            if (authStatus) {
              setIsAuthenticated(true);
            }
          }, []);
          
          useEffect(() => {
            if (!isAuthenticated) return;
            
            const unsubscribe = db.subscribeToUsers((users) => {
              setUsers(users);
            });
            
            return () => {
              unsubscribe();
            };
          }, [isAuthenticated]);
          
          const loadData = async () => {
            const usersSnapshot = await db.ref('users').once('value');
            const usersData = usersSnapshot.val() || {};
            setUsers(Object.values(usersData));
            
            const chatsSnapshot = await db.ref('chats').once('value');
            setChats(chatsSnapshot.val() || {});
            
            const onlineSnapshot = await db.ref('online_users').once('value');
            const onlineData = onlineSnapshot.val() || {};
            
            const registeredUsers = Object.values(usersData);
            const filteredOnline = Object.values(onlineData).filter(onlineUser => {
              if (!onlineUser.isTemp) return true;
              const hasRegistered = registeredUsers.some(regUser => regUser.username === onlineUser.username);
              return !hasRegistered;
            });
            
            setOnlineUsers(filteredOnline);
          };
          
          const handleLogin = async () => {
            const result = await db.adminLogin(username, password);
            
            if (!result.success) {
              alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
              return;
            }
            
            AdminAuth.save({ username });
            setIsAuthenticated(true);
          };
          
          const handleLogout = () => {
            if (window.confirm('ç¡®å®šè¦é€€å‡ºç®¡ç†åå°å—ï¼Ÿ')) {
              setIsAuthenticated(false);
              AdminAuth.clear();
            }
          };
          
          const handleDeleteUser = async (userId) => {
            if (window.confirm('ç¡®å®šè¦åˆ é™¤æ­¤ç”¨æˆ·å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼')) {
              await db.ref(`users/${userId}`).remove();
              
              const chatsSnapshot = await db.ref('chats').once('value');
              const chatsData = chatsSnapshot.val() || {};
              Object.keys(chatsData).forEach(chatId => {
                if (chatId.includes(userId)) {
                  db.ref(`chats/${chatId}`).remove();
                }
              });
              
              loadData();
              alert('ç”¨æˆ·å·²åˆ é™¤ï¼');
            }
          };
          
          const handleBatchDelete = async () => {
            if (selectedUserIds.length === 0) {
              alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„ç”¨æˆ·ï¼');
              return;
            }
            
            if (window.confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedUserIds.length} ä¸ªç”¨æˆ·å—ï¼Ÿ`)) {
              for (const userId of selectedUserIds) {
                await db.ref(`users/${userId}`).remove();
                
                const chatsSnapshot = await db.ref('chats').once('value');
                const chatsData = chatsSnapshot.val() || {};
                Object.keys(chatsData).forEach(chatId => {
                  if (chatId.includes(userId)) {
                    db.ref(`chats/${chatId}`).remove();
                  }
                });
              }
              
              setSelectedUserIds([]);
              loadData();
              alert(`å·²åˆ é™¤ ${selectedUserIds.length} ä¸ªç”¨æˆ·ï¼`);
            }
          };
          
          const handleUpdateUser = async (userId, updates) => {
            await db.ref(`users/${userId}`).update(updates);
            setEditingUser(null);
            loadData();
            alert('ç”¨æˆ·ä¿¡æ¯å·²æ›´æ–°ï¼');
          };
          
          const handleResetPassword = (userId) => {
            if (window.confirm('ç¡®å®šè¦å°†æ­¤ç”¨æˆ·å¯†ç é‡ç½®ä¸º 123456 å—ï¼Ÿ')) {
              handleUpdateUser(userId, { password: '123456' });
            }
          };
          
          const toggleUserSelection = (userId) => {
            if (selectedUserIds.includes(userId)) {
              setSelectedUserIds(selectedUserIds.filter(id => id !== userId));
            } else {
              setSelectedUserIds([...selectedUserIds, userId]);
            }
          };
          
          const toggleSelectAll = () => {
            if (selectedUserIds.length === users.length) {
              setSelectedUserIds([]);
            } else {
              setSelectedUserIds(users.map(u => u.id));
            }
          };
          
          if (!isAuthenticated) {
            return (
              <div style={{
                minHeight: '100vh',
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '20px'
              }}>
                <form className="login-container" onSubmit={handleLogin}>
                  <div className="login-header">
                    <div className="login-icon">ğŸ”</div>
                    <h1 className="login-title">ç®¡ç†åå°</h1>
                    <p className="login-subtitle">è¯·ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•</p>
                  </div>
                  
                  <div className="form-group">
                    <label className="form-label">ç®¡ç†å‘˜è´¦å·</label>
                    <input
                      type="text"
                      className="form-input"
                      value={username}
                      onChange={(e) => setUsername(e.target.value)}
                      placeholder="è¾“å…¥ç®¡ç†å‘˜è´¦å·"
                      required
                    />
                  </div>
                  
                  <div className="form-group">
                    <label className="form-label">ç®¡ç†å‘˜å¯†ç </label>
                    <input
                      type="password"
                      className="form-input"
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      placeholder="è¾“å…¥ç®¡ç†å‘˜å¯†ç "
                      required
                    />
                  </div>
                  
                  <button type="submit" className="btn btn-primary" style={{ width: '100%' }}>
                    ğŸ”“ ç™»å½•åå°
                  </button>
                </form>
              </div>
            );
          }
          
          return (
            <div className="admin-container">
              <div className="admin-wrapper">
                <div className="admin-header">
                  <div className="admin-title-section">
                    <h1 className="admin-title">ğŸ“Š ç®¡ç†åå°</h1>
                    <p className="admin-subtitle">ç³»ç»Ÿæ•°æ®æ€»è§ˆä¸ç®¡ç†</p>
                  </div>
                  
                  <div className="admin-actions">
                    <button className="btn btn-secondary" onClick={loadData}>
                      ğŸ”„ åˆ·æ–°æ•°æ®
                    </button>
                    <button className="btn btn-danger" onClick={handleLogout}>
                      ğŸšª é€€å‡ºç™»å½•
                    </button>
                  </div>
                </div>
                
                <div className="admin-content">
                  {/* ç»Ÿè®¡å¡ç‰‡ */}
                  <div className="stats-grid">
                    <div className="stat-card">
                      <h3>æ³¨å†Œç”¨æˆ·</h3>
                      <div className="stat-value">{users.length}</div>
                    </div>
                    <div className="stat-card">
                      <h3>èŠå¤©ä¼šè¯</h3>
                      <div className="stat-value">{Object.keys(chats).length}</div>
                    </div>
                    <div className="stat-card">
                      <h3>åœ¨çº¿ç”¨æˆ·</h3>
                      <div className="stat-value">{onlineUsers.length}</div>
                    </div>
                    <div className="stat-card">
                      <h3>å……å€¼è®°å½•</h3>
                      <div className="stat-value">
                        {users.reduce((sum, u) => sum + (u.rechargeHistory || []).length, 0)}
                      </div>
                    </div>
                  </div>
                  
                  {/* æ ‡ç­¾é¡µ */}
                  <div className="admin-tabs">
                    <button className={`admin-tab ${activeTab === 'users' ? 'active' : ''}`} onClick={() => setActiveTab('users')}>
                      ğŸ‘¥ ç”¨æˆ·
                    </button>
                    <button className={`admin-tab ${activeTab === 'chats' ? 'active' : ''}`} onClick={() => setActiveTab('chats')}>
                      ğŸ’¬ èŠå¤©
                    </button>
                    <button className={`admin-tab ${activeTab === 'recharge' ? 'active' : ''}`} onClick={() => setActiveTab('recharge')}>
                      ğŸ’° å……å€¼
                    </button>
                    <button className={`admin-tab ${activeTab === 'online' ? 'active' : ''}`} onClick={() => setActiveTab('online')}>
                      ğŸŸ¢ åœ¨çº¿
                    </button>
                  </div>
                  
                  {/* å†…å®¹ */}
                  {activeTab === 'users' && (
                    <UsersTab
                      users={users}
                      selectedUserIds={selectedUserIds}
                      onToggleSelect={toggleUserSelection}
                      onToggleSelectAll={toggleSelectAll}
                      onBatchDelete={handleBatchDelete}
                      onDeleteUser={handleDeleteUser}
                      onEditUser={setEditingUser}
                      onViewUser={setSelectedUser}
                    />
                  )}
                  
                  {activeTab === 'chats' && (
                    <ChatsTab chats={chats} onViewChat={setSelectedChat} />
                  )}
                  
                  {activeTab === 'recharge' && (
                    <RechargeTab users={users} />
                  )}
                  
                  {activeTab === 'online' && (
                    <OnlineTab onlineUsers={onlineUsers} />
                  )}
                </div>
              </div>
              
              {/* æ¨¡æ€æ¡† */}
              {selectedUser && (
                <UserDetailModal user={selectedUser} onClose={() => setSelectedUser(null)} />
              )}
              
              {editingUser && (
                <EditUserModal
                  user={editingUser}
                  onClose={() => setEditingUser(null)}
                  onSave={handleUpdateUser}
                  onResetPassword={handleResetPassword}
                />
              )}
              
              {selectedChat && (
                <ChatDetailModal chat={selectedChat} onClose={() => setSelectedChat(null)} />
              )}
            </div>
          );
        };
        
        // æ ‡ç­¾é¡µç»„ä»¶ï¼ˆå¾…ç»­...ï¼‰
        
        // ç”¨æˆ·ç®¡ç†æ ‡ç­¾é¡µ
        const UsersTab = ({ users, selectedUserIds, onToggleSelect, onToggleSelectAll, onBatchDelete, onDeleteUser, onEditUser, onViewUser }) => (
          <div>
            <div className="toolbar">
              <button className="btn btn-secondary" onClick={onToggleSelectAll}>
                âœ“ {selectedUserIds.length === users.length ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}
              </button>
              {selectedUserIds.length > 0 && (
                <button className="btn btn-danger" onClick={onBatchDelete}>
                  ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤ ({selectedUserIds.length})
                </button>
              )}
            </div>
            
            <h3 style={{ marginBottom: '15px', fontSize: '16px' }}>
              æ³¨å†Œç”¨æˆ·åˆ—è¡¨ (å…± {users.length} äºº)
            </h3>
            
            {users.length === 0 ? (
              <div className="empty-state">
                <p>æš‚æ— æ³¨å†Œç”¨æˆ·</p>
              </div>
            ) : (
              <div className="table-wrapper">
                <table className="data-table">
                  <thead>
                    <tr>
                      <th>é€‰æ‹©</th>
                      <th>ç”¨æˆ·å</th>
                      <th>æ€§åˆ«</th>
                      <th>åœ°åŒº</th>
                      <th>é‡‘å¸</th>
                      <th>æ³¨å†Œæ—¶é—´</th>
                      <th>æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    {users.map(user => (
                      <tr key={user.id}>
                        <td>
                          <input
                            type="checkbox"
                            checked={selectedUserIds.includes(user.id)}
                            onChange={() => onToggleSelect(user.id)}
                            style={{ width: '16px', height: '16px', cursor: 'pointer' }}
                          />
                        </td>
                        <td>{user.username}</td>
                        <td style={{ color: user.gender === 'male' ? '#4A90E2' : '#FF69B4' }}>
                          {user.gender === 'male' ? 'â™‚' : 'â™€'}
                        </td>
                        <td>{user.location}</td>
                        <td><strong>{user.coins}</strong></td>
                        <td>{new Date(user.registeredAt).toLocaleDateString('zh-CN')}</td>
                        <td>
                          <div style={{ display: 'flex', gap: '4px', flexWrap: 'wrap' }}>
                            <button className="btn-small btn-secondary" onClick={() => onViewUser(user)}>ğŸ‘ï¸</button>
                            <button className="btn-small btn-warning" onClick={() => onEditUser(user)}>âœï¸</button>
                            <button className="btn-small btn-danger" onClick={() => onDeleteUser(user.id)}>ğŸ—‘ï¸</button>
                          </div>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        );
        
        // èŠå¤©è®°å½•æ ‡ç­¾é¡µ
        const ChatsTab = ({ chats, onViewChat }) => (
          <div>
            <h3 style={{ marginBottom: '15px', fontSize: '16px' }}>
              èŠå¤©è®°å½•ç»Ÿè®¡ (å…± {Object.keys(chats).length} ä¸ªä¼šè¯)
            </h3>
            
            {Object.keys(chats).length === 0 ? (
              <div className="empty-state">
                <p>æš‚æ— èŠå¤©è®°å½•</p>
              </div>
            ) : (
              <div>
                {Object.entries(chats).map(([chatId, messages]) => (
                  <div key={chatId} className="chat-preview" onClick={() => onViewChat({ chatId, messages })}>
                    <div className="chat-preview-header">ä¼šè¯ID: {chatId}</div>
                    <div style={{ fontSize: '13px', color: '#6c757d' }}>
                      æ¶ˆæ¯æ•°é‡: <strong style={{ color: '#667eea' }}>{Object.keys(messages || {}).length} æ¡</strong> (ç‚¹å‡»æŸ¥çœ‹)<br />
                      æœ€åæ´»åŠ¨: {new Date(Object.values(messages || {})[Object.keys(messages || {}).length - 1]?.timestamp || 0).toLocaleDateString('zh-CN')}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        );
        
        // å……å€¼è®°å½•æ ‡ç­¾é¡µ
        const RechargeTab = ({ users }) => {
          const recharges = users.flatMap(user =>
            (user.rechargeHistory || []).map(r => ({ ...r, username: user.username }))
          );
          
          return (
            <div>
              <h3 style={{ marginBottom: '15px', fontSize: '16px' }}>å……å€¼è®°å½•</h3>
              
              {recharges.length === 0 ? (
                <div className="empty-state">
                  <p>æš‚æ— å……å€¼è®°å½•</p>
                </div>
              ) : (
                <>
                  <div className="table-wrapper">
                    <table className="data-table">
                      <thead>
                        <tr>
                          <th>ç”¨æˆ·å</th>
                          <th>é‡‘å¸</th>
                          <th>é‡‘é¢</th>
                          <th>æ—¶é—´</th>
                        </tr>
                      </thead>
                      <tbody>
                        {recharges.map((record, index) => (
                          <tr key={index}>
                            <td>{record.username}</td>
                            <td><strong>{record.coins}</strong></td>
                            <td style={{ color: '#28a745', fontWeight: 'bold' }}>Â¥{record.amount}</td>
                            <td>{new Date(record.timestamp).toLocaleDateString('zh-CN')}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                  
                  <div style={{ marginTop: '15px', padding: '12px', background: '#f8f9fa', borderRadius: '8px', fontSize: '13px' }}>
                    <strong>å……å€¼ç»Ÿè®¡ï¼š</strong><br />
                    æ€»å……å€¼é‡‘é¢: Â¥{recharges.reduce((sum, r) => sum + r.amount, 0)}<br />
                    æ€»å……å€¼é‡‘å¸: {recharges.reduce((sum, r) => sum + r.coins, 0)}
                  </div>
                </>
              )}
            </div>
          );
        };
        
        // åœ¨çº¿çŠ¶æ€æ ‡ç­¾é¡µ
        const OnlineTab = ({ onlineUsers }) => (
          <div>
            <h3 style={{ marginBottom: '15px', fontSize: '16px' }}>
              åœ¨çº¿ç”¨æˆ· (å…± {onlineUsers.length} äºº)
            </h3>
            
            {onlineUsers.length === 0 ? (
              <div className="empty-state">
                <p>æš‚æ— åœ¨çº¿ç”¨æˆ·</p>
              </div>
            ) : (
              <div className="table-wrapper">
                <table className="data-table">
                  <thead>
                    <tr>
                      <th>ç”¨æˆ·å</th>
                      <th>æ€§åˆ«</th>
                      <th>åœ°åŒº</th>
                      <th>ç±»å‹</th>
                      <th>çŠ¶æ€</th>
                      <th>æœ€åæ´»åŠ¨</th>
                    </tr>
                  </thead>
                  <tbody>
                    {onlineUsers.map(user => (
                      <tr key={user.tempId || user.id}>
                        <td>{user.username}</td>
                        <td style={{ color: user.gender === 'male' ? '#4A90E2' : '#FF69B4' }}>
                          {user.gender === 'male' ? 'â™‚' : 'â™€'}
                        </td>
                        <td>{user.location}</td>
                        <td>
                          {user.isTemp ? (
                            <span className="badge badge-warning">ä¸´æ—¶</span>
                          ) : (
                            <span className="badge badge-success">æ³¨å†Œ</span>
                          )}
                        </td>
                        <td>
                          <span className={`badge ${user.isOnline ? 'badge-online' : 'badge-offline'}`}>
                            {user.isOnline ? 'ğŸŸ¢' : 'âš«'}
                          </span>
                        </td>
                        <td>{new Date(user.lastSeen).toLocaleDateString('zh-CN')}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        );
        
        // ç”¨æˆ·è¯¦æƒ…æ¨¡æ€æ¡†
        const UserDetailModal = ({ user, onClose }) => (
          <div className="modal-overlay" onClick={onClose}>
            <div className="modal" onClick={(e) => e.stopPropagation()}>
              <div className="modal-header">
                <h2 className="modal-title">ç”¨æˆ·è¯¦æƒ…</h2>
                <button className="close-btn" onClick={onClose}>âœ•</button>
              </div>
              
              <div className="info-section">
                <h3>åŸºæœ¬ä¿¡æ¯</h3>
                <div className="info-card">
                  <div className="info-row">
                    <span>ç”¨æˆ·å:</span>
                    <span>{user.username}</span>
                  </div>
                  <div className="info-row">
                    <span>æ€§åˆ«:</span>
                    <span style={{ color: user.gender === 'male' ? '#4A90E2' : '#FF69B4' }}>
                      {user.gender === 'male' ? 'â™‚ ç”·' : 'â™€ å¥³'}
                    </span>
                  </div>
                  <div className="info-row">
                    <span>åœ°åŒº:</span>
                    <span>{user.location}</span>
                  </div>
                  <div className="info-row">
                    <span>é‡‘å¸:</span>
                    <span><strong>{user.coins}</strong></span>
                  </div>
                  <div className="info-row">
                    <span>æ³¨å†Œæ—¶é—´:</span>
                    <span>{new Date(user.registeredAt).toLocaleString('zh-CN')}</span>
                  </div>
                </div>
              </div>
              
              <div className="info-section">
                <h3>ç™»å½•å†å²</h3>
                <div className="info-card">
                  {(user.loginHistory || []).length === 0 ? (
                    <p style={{ textAlign: 'center', color: '#6c757d', fontSize: '13px' }}>æš‚æ— ç™»å½•è®°å½•</p>
                  ) : (
                    (user.loginHistory || []).map((login, index) => (
                      <div key={index} className="history-item">
                        {new Date(login.timestamp).toLocaleString('zh-CN')} - {login.location}
                      </div>
                    ))
                  )}
                </div>
              </div>
            </div>
          </div>
        );
        
        // ç¼–è¾‘ç”¨æˆ·æ¨¡æ€æ¡†
        const EditUserModal = ({ user, onClose, onSave, onResetPassword }) => {
          const [coins, setCoins] = useState(user.coins);
          
          return (
            <div className="modal-overlay" onClick={onClose}>
              <div className="modal" onClick={(e) => e.stopPropagation()}>
                <div className="modal-header">
                  <h2 className="modal-title">ç¼–è¾‘ç”¨æˆ·</h2>
                  <button className="close-btn" onClick={onClose}>âœ•</button>
                </div>
                
                <div className="form-group">
                  <label className="form-label">ç”¨æˆ·: {user.username}</label>
                </div>
                
                <div className="form-group">
                  <label className="form-label">é‡‘å¸æ•°é‡</label>
                  <input
                    type="number"
                    className="form-input"
                    value={coins}
                    onChange={(e) => setCoins(parseInt(e.target.value) || 0)}
                    min="0"
                  />
                </div>
                
                <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                  <button className="btn btn-success" onClick={() => onSave(user.id, { coins })}>
                    ğŸ’¾ ä¿å­˜
                  </button>
                  <button className="btn btn-warning" onClick={() => onResetPassword(user.id)}>
                    ğŸ”‘ é‡ç½®å¯†ç 
                  </button>
                </div>
              </div>
            </div>
          );
        };
        
        // èŠå¤©è¯¦æƒ…æ¨¡æ€æ¡†
        const ChatDetailModal = ({ chat, onClose }) => {
          const messages = Object.values(chat.messages || {}).sort((a, b) => a.timestamp - b.timestamp);
          
          return (
            <div className="modal-overlay" onClick={onClose}>
              <div className="modal" onClick={(e) => e.stopPropagation()}>
                <div className="modal-header">
                  <h2 className="modal-title">èŠå¤©è®°å½•</h2>
                  <button className="close-btn" onClick={onClose}>âœ•</button>
                </div>
                
                <div className="info-section">
                  <h3>ä¼šè¯ID: {chat.chatId}</h3>
                  <p style={{ color: '#6c757d', fontSize: '13px', marginBottom: '12px' }}>
                    å…± {messages.length} æ¡æ¶ˆæ¯
                  </p>
                  
                  <div className="chat-messages-list">
                    {messages.map((msg, index) => (
                      <div key={index} className="chat-message-item">
                        <div style={{ fontWeight: 'bold', color: '#667eea', marginBottom: '4px', fontSize: '12px' }}>
                          å‘é€è€…: {msg.sender}
                        </div>
                        <div style={{ marginBottom: '4px' }}>{msg.text}</div>
                        <div style={{ fontSize: '11px', color: '#6c757d' }}>
                          {new Date(msg.timestamp).toLocaleString('zh-CN')}
                          {msg.read && ' Â· å·²è¯»'}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          );
        };
        
        // æ¸²æŸ“
        ReactDOM.createRoot(document.getElementById('root')).render(<AdminPanel />);
    </script>
</body>
</html>
